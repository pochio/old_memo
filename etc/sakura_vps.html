<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>さくらVPS + CentOS7 による外部公開サーバの構築 &#8212; Memo  ドキュメント</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="prev" title="その他、なんか色々" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          MEMO</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../oss/index.html">OSS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../oss/sphinx.html">Sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/gns3.html">GNS3 (Graphical Network Simulator)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/capturestream.html">CaptureStream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/zabbix.html">ZABBIX導入手順 (RHEL/CentOS6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/zabbix3.html">ZABBIX 3.0.1 のインストール</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/tsung.html">Tsung によるウェブサイトの負荷試験</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/ksar7.html">kSar7 による sysstat(sar) 情報のグラフ表示</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/cacti.html">Cacti のインストール</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/manual_p2v.html">ssh+tarを用いたP2V</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/mysql.html">公式レポジトリを利用したMySQLのインストール</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/apache2.4_memo.html">Apache 2.4 備忘録</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/percona_install.html">Percona XtraDB Cluster のインストール手順</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oss/gns3-on-cloud.html">Ubuntu 16.04 LTS　+ GNS3 v1.4.5 リモートサーバの構築</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">RHEL/CentOS/Fedora</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../linux/rpmdev.html">RPMの作成手順</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linux/createrepo.html">ローカル・リポジトリの構築</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linux/rpmrepo_gpgsign.html">RPMパッケージと、ローカル・リポジトリへの署名方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linux/yum-autoupdate.html">yum-cron による自動アップデート</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linux/sophos.html">Sophos Antivirus for Linux 無償版の導入と設定</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linux/jenkins.html">CentOS7.x + Jenkins を利用したRPMビルド環境の構築</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../windows/index.html">Windows Server/Client</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../windows/win2k12_nfs_mount.html">Windows Server 2008 R2 / 2012 R2 のNFSクライアント設定</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../aws/index.html">AWS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../aws/s3_logarchive.html">AWS/S3へのログバックアップ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../aws/lsyncd.html">AmazonLinux + lsyncd+rsyncd の確認</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">その他、なんか色々</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">さくらVPS + CentOS7 による外部公開サーバの構築</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">さくらVPS + CentOS7 による外部公開サーバの構築</a><ul>
<li><a class="reference internal" href="#aws">AWSの環境削除</a></li>
<li><a class="reference internal" href="#vps">さくらVPS と契約</a></li>
<li><a class="reference internal" href="#os">OSの再インストール</a></li>
<li><a class="reference internal" href="#centos7">CentOS7 の初期設定</a><ul>
<li><a class="reference internal" href="#policycoreutils-python">&quot;policycoreutils-python&quot; のインストール</a></li>
<li><a class="reference internal" href="#ssh">ユーザ作成と、SSH公開鍵の設置</a></li>
<li><a class="reference internal" href="#nic">NICの停止</a></li>
<li><a class="reference internal" href="#sshd">&quot;sshd&quot;の設定</a></li>
<li><a class="reference internal" href="#selinux">SELinuxポリシーの変更</a></li>
<li><a class="reference internal" href="#firewalld">firewalld の参考資料</a></li>
<li><a class="reference internal" href="#id5">firewalld の設定</a><ul>
<li><a class="reference internal" href="#id6">&quot;sshd&quot;のポート設定</a></li>
<li><a class="reference internal" href="#id7">ルールの入れ替え</a></li>
<li><a class="reference internal" href="#id8">&quot;firewalld&quot;のリロードと確認</a></li>
<li><a class="reference internal" href="#ip">接続元IPの制限</a></li>
<li><a class="reference internal" href="#id9">&quot;firewalld&quot;のリロードと確認</a></li>
<li><a class="reference internal" href="#id10">SSHアクセスの確認</a></li>
<li><a class="reference internal" href="#id11">&quot;firewalld&quot; のログ設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yum">&quot;yum&quot;アップデートの実行</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dns">独自ドメインの取得 と さくらインターネットDNSサーバへの登録</a></li>
<li><a class="reference internal" href="#zoho">Zohoを利用した独自ドメイン・メール環境の構築</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="index.html" title="Previous Chapter: その他、なんか色々"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; その他、なんか色々</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="vps-centos7">
<h1><a class="toc-backref" href="#id15">さくらVPS + CentOS7 による外部公開サーバの構築</a><a class="headerlink" href="#vps-centos7" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="contents topic" id="id1">
<p class="topic-title first">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#vps-centos7" id="id15">さくらVPS + CentOS7 による外部公開サーバの構築</a><ul>
<li><a class="reference internal" href="#aws" id="id16">AWSの環境削除</a></li>
<li><a class="reference internal" href="#vps" id="id17">さくらVPS と契約</a></li>
<li><a class="reference internal" href="#os" id="id18">OSの再インストール</a></li>
<li><a class="reference internal" href="#centos7" id="id19">CentOS7 の初期設定</a></li>
<li><a class="reference internal" href="#dns" id="id20">独自ドメインの取得 と さくらインターネットDNSサーバへの登録</a></li>
<li><a class="reference internal" href="#zoho" id="id21">Zohoを利用した独自ドメイン・メール環境の構築</a></li>
</ul>
</li>
</ul>
</div>
<p>個人で借りていた Amazon EC2 から、さくらVPS へお引っ越しした際のメモ</p>
<ul class="simple">
<li>Amazon EC2 上で稼働していたVPSを &quot;さくらVPS&quot; に乗り換える</li>
<li>独自ドメインも合わせて Amazon Route53 より、&quot;さくらVPS&quot; へ移行する。</li>
<li>移行後のVPSは CentOS7 とし、firewall-cmd など、新しいコマンド郡を使う。</li>
<li>Nginx(WEBサーバ),Ghost(Blogシステム),Sphinx(ドキュメント作成)などの環境を整理、メモをどこからでも参照出来る状態にする。</li>
<li>ZOHOの無料枠を利用し、独自ドメインのメールアドレスを利用出来る状態にする。</li>
</ul>
<div class="section" id="aws">
<h2><a class="toc-backref" href="#id16">AWSの環境削除</a><a class="headerlink" href="#aws" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>設定が複数に散らばっていて面倒だったので、一旦アカウントごと全ての削除した。 <a class="reference external" href="http://blog.serverworks.co.jp/tech/2013/04/09/cancel-aws-account/">こちら</a> に書いてある事そのままで、請求情報は見れるが、サービスは利用出来ない状態になった。</p>
</div>
<div class="section" id="vps">
<h2><a class="reference external" href="http://vps.sakura.ad.jp/">さくらVPS</a> と契約<a class="headerlink" href="#vps" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>大した事はしないので <a class="reference external" href="http://vps.sakura.ad.jp/specification/">最小スペック</a> を選択、無料期間中はさくらのDNSが利用できなかったため、無料期間を即やめて本契約をした。</p>
</div>
<div class="section" id="os">
<h2><a class="toc-backref" href="#id18">OSの再インストール</a><a class="headerlink" href="#os" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>CentOS7 での利用したかったので、OSの再インストール実行した。</p>
<p>最初は HTML5版のコンソールから普通にGUIでインストールを行おうとしたが、解像度の問題でうまくいかなかった。結局ブート後、CentOSロゴが表示された段階で [TAB] キーを押し、ブートフラグに&quot;text&quot;を追加、テキストモードでのインストールを行った。</p>
<p>パッケージは &quot;minimal&quot; で導入した。</p>
</div>
<div class="section" id="centos7">
<h2><a class="toc-backref" href="#id19">CentOS7 の初期設定</a><a class="headerlink" href="#centos7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>OS再インストールが完了し、仮想ゲストが起動した段階で HTML5版コンソール を利用して以下の作業を行った。</p>
<div class="section" id="policycoreutils-python">
<h3>&quot;policycoreutils-python&quot; のインストール<a class="headerlink" href="#policycoreutils-python" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>SELinuxを設定するためのパッケージ &quot;policycoreutils-python&quot; をインストール</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> yum install policycoreutils-python
</pre></div>
</div>
</div>
<div class="section" id="ssh">
<h3>ユーザ作成と、SSH公開鍵の設置<a class="headerlink" href="#ssh" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>リモートからアクセスするためのユーザを作成し、SSH公開鍵を設置する。</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> groupadd &lt;groupname&gt;
<span class="gp">#</span> useradd -g &lt;groupname&gt; &lt;username&gt;
<span class="gp">#</span> passwd &lt;username&gt;
<span class="go">Password: ********</span>
<span class="gp">#</span> ssh &lt;username&gt;@localhost
<span class="go">Password: ********</span>
<span class="gp">$</span> <span class="nb">cd</span> .ssh
<span class="gp">$</span> vi authorized_keys
<span class="go">  -&gt;公開鍵を登録</span>
<span class="gp">$</span> chmod <span class="m">600</span> authorized_keys
<span class="gp">$</span> <span class="nb">exit</span>
</pre></div>
</div>
<p>SSH鍵を作成した端末から、ログイン出来る事を確認</p>
</div>
<div class="section" id="nic">
<h3>NICの停止<a class="headerlink" href="#nic" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>設定中に余計なアクセスがないように、HTML5コンソールから NIC を停止した。</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> ifdown eth0
</pre></div>
</div>
</div>
<div class="section" id="sshd">
<h3>&quot;sshd&quot;の設定<a class="headerlink" href="#sshd" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>&quot;/etc/ssh/sshd_config&quot; に対し、下記項目の変更を行った。</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">cd</span> /etc/ssh/sshd_config
<span class="gp">#</span> cp sshd_config<span class="o">{</span>,.orig<span class="o">}</span>
<span class="gp">#</span> vi /etc/ssh/sshd_config
</pre></div>
</div>
<table border="1" class="table-striped docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項目</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Port xxxx</td>
<td>Listenポートの変更 (22 -&gt; 任意のポートへ)</td>
</tr>
<tr class="row-odd"><td>AddressFamily inet</td>
<td>IPv4系のみリッスン</td>
</tr>
<tr class="row-even"><td>ListenAddress</td>
<td>ListenするIPアドレスの指定</td>
</tr>
<tr class="row-odd"><td>Protocol 2</td>
<td>ssh2 でのアクセスのみ許可</td>
</tr>
<tr class="row-even"><td>LoginGraceTime 30s</td>
<td>ログインまでの待ち時間を30秒に</td>
</tr>
<tr class="row-odd"><td>PermitRootLogin no</td>
<td>&quot;root&quot;ユーザによるログインを拒否</td>
</tr>
<tr class="row-even"><td>StrictModes yes</td>
<td>ホームディレクトリのパーミッション確認</td>
</tr>
<tr class="row-odd"><td>MaxAuthTries 1</td>
<td>認証の試行回数を&quot;1&quot;に(1回の失敗で切断)</td>
</tr>
<tr class="row-even"><td>MaxSessions 4</td>
<td>セッション数の制限(自分が利用するだけなので少なくした)</td>
</tr>
<tr class="row-odd"><td>PubkeyAuthenticationyes</td>
<td>公開鍵認証を行う</td>
</tr>
<tr class="row-even"><td>PasswordAuthentication no</td>
<td>パスワード認証を拒否</td>
</tr>
<tr class="row-odd"><td>AllowUsers  &lt;userid&gt;&#64;&lt;password&gt;</td>
<td>接続元ユーザの制限</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="selinux">
<h3>SELinuxポリシーの変更<a class="headerlink" href="#selinux" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>&quot;sshd&quot; のポート設定を変更したので、SELinuxのポリシーも変更する(末尾は&quot;sshd&quot;に設定したポートを指定)</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> semanage port -a -t ssh_port_t -p tcp &lt;sshd_openport&gt;
</pre></div>
</div>
<p>SSHを再起動し、指定したポートでListenしている事を確認する</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> systemctl restart sshd
<span class="gp">#</span> ss -t -l
</pre></div>
</div>
</div>
<div class="section" id="firewalld">
<h3>firewalld の参考資料<a class="headerlink" href="#firewalld" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><strong>2016/02/18 追記</strong></p>
<p>意外と firewalld で検索しに来る人がいるようなので、参考リンク貼っとく。</p>
<ul class="simple">
<li><a class="reference external" href="http://www.slideshare.net/enakai/firewalld-study-v10">Linux女子部　firewalld徹底入門！</a></li>
<li><a class="reference external" href="http://www.certdepot.net/rhel7-get-started-firewalld/">RHEL7: How to get started with Firewalld.</a></li>
<li><a class="reference external" href="https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html">Red Hat Enterprise Linux 7 - セキュリティガイド</a></li>
</ul>
</div>
<div class="section" id="id5">
<h3>firewalld の設定<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>firewalld にポート変更した &quot;sshd&quot; の設定と、アクセス元IPの制限を設定する。</p>
<div class="section" id="id6">
<h4>&quot;sshd&quot;のポート設定<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>既存のルールを複製/追加する。</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> <span class="nb">cd</span> /etc/firewalld/service
<span class="gp">#</span> sudo cp /usr/lib/firewalld/services/ssh.xml ./ssh-cm.xml
<span class="gp">#</span> sudo vi ssh-cm.xml
</pre></div>
</div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>5c5
&lt;   &lt;port protocol=&quot;tcp&quot; port=&quot;22&quot;/&gt;
<span class="gd">---</span>
&gt;   &lt;port protocol=&quot;tcp&quot; port=&quot;&lt;sshd_openport&gt;&quot;/&gt;
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4>ルールの入れ替え<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>デフォルトの&quot;ssh&quot;と、追加した&quot;ssh-cm&quot;を入れ替える。</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> firewall-cmd --permanent --remove-service<span class="o">=</span><span class="s1">&#39;ssh&#39;</span> --zone<span class="o">=</span>public
<span class="gp">#</span> firewall-cmd --permanent --add-service<span class="o">=</span><span class="s1">&#39;ssh-cm&#39;</span> --zone<span class="o">=</span>public
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h4>&quot;firewalld&quot;のリロードと確認<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>&quot;firewalld&quot;をリロードし、デフォルトの&quot;ssh&quot;が消えて、&quot;ssh-cm&quot;に入れ替わっている事を確認</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> firewall-cmd --reload
<span class="gp">#</span> firewall-cmd --list-all
<span class="go">public (default, active)</span>
<span class="go">interfaces: eth0</span>
<span class="go">sources:</span>
<span class="go">services: dhcpv6-client ssh-cm     #&lt;-&quot;ssh&quot;が消え、&quot;ssh-cm&quot; が増えている</span>
<span class="go">ports:</span>
<span class="go">masquerade: no</span>
<span class="go">forward-ports:</span>
<span class="go">icmp-blocks:</span>
<span class="go">rich rules:</span>
</pre></div>
</div>
</div>
<div class="section" id="ip">
<h4>接続元IPの制限<a class="headerlink" href="#ip" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>既知のIP以外 &quot;ssh-cm&quot; にアクセス出来ないよう設定する。削除したい場合は &quot;--remove-rich-rule&quot; で削除出来る(2016/02/18追記)</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> firewall-cmd --permanent --add-rich-rule<span class="o">=</span><span class="s1">&#39;rule family=&quot;ipv4&quot; source address=&quot;&lt;ipaddress&gt;/32&quot; invert=true service name=&quot;ssh-cm&quot; log prefix=&quot;ssh connection &quot; level=&quot;info&quot; drop&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>&quot;firewalld&quot;のリロードと確認<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>&quot;firewalld&quot;をリロードし、設定が反映されている事を確認</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> firewall-cmd --reload
<span class="gp">#</span> firewall-cmd --list-all
<span class="go">public (default, active)</span>
<span class="go">interfaces: eth0</span>
<span class="go">sources:</span>
<span class="go">services: dhcpv6-client ssh-cm</span>
<span class="go">ports:</span>
<span class="go">masquerade: no</span>
<span class="go">forward-ports:</span>
<span class="go">icmp-blocks: destination-unreachable echo-reply echo-request</span>
<span class="go">rich rules:</span>
<span class="go">  rule family=&quot;ipv4&quot; source NOT address=&quot;&lt;ipaddress&gt;/32&quot; service name=&quot;ssh-cm&quot; drop</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h4>SSHアクセスの確認<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>停止していたNICを元に戻し、&quot;ssh-cm&quot;へのアクセスを許可した端末からアクセス出来る事を確認する。</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> ifup eth0
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h4>&quot;firewalld&quot; のログ設定<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>&quot;ssh-cm&quot; のアクセス設定で、ログを出力するようにしたが、そのままだと &quot;messages&quot; に大量に書き込まれることになるので、必要に応じて以下の設定を行う。 &quot;dmesg&quot; は諦め(ry</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> vi /etc/rsyslog.conf
<span class="go">...</span>
<span class="gp">#</span><span class="c1">### RULES ####         #&lt;-&quot;#### RULES ####&quot;の直下に追記する</span>

<span class="gp">#</span><span class="c1"># Firewalld</span>
<span class="gp">#</span> ssh-cm
<span class="go">if ( $msg contains &#39;ssh connection&#39; ) then /var/log/firewalld-logs/ssh-cm.log</span>
<span class="go">&amp; ~</span>
</pre></div>
</div>
<p>ローテーションの設定 と 確認</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> vi /etc/logrotate.d/syslog
<span class="go">...</span>
<span class="go">&quot;/var/log/firewalld-logs/ssh-cm.log&quot; を追記</span>
<span class="gp">#</span> logrotate -d /etc/logrotate.conf
</pre></div>
</div>
<p>ログ出力先の作成 と rsyslog の再起動</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> mkdir /var/log/firewalld-logs
<span class="gp">#</span> systemctl restart rsyslog
</pre></div>
</div>
<p>あとはアクセス許可外の端末からアクセスを試み、ログが生成される事、&quot;messages&quot;に出力されていない事などを確認</p>
</div>
</div>
<div class="section" id="yum">
<h3>&quot;yum&quot;アップデートの実行<a class="headerlink" href="#yum" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> yum upgrade -y <span class="o">&amp;&amp;</span> shutdown -r now
</pre></div>
</div>
<p>あとはサーバの用途に応じて適当に頑張るだけ。</p>
</div>
</div>
<div class="section" id="dns">
<h2><a class="toc-backref" href="#id20">独自ドメインの取得 と さくらインターネットDNSサーバへの登録</a><a class="headerlink" href="#dns" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>独自ドメインの取得は &quot;<a class="reference external" href="http://muumuu-domain.com/">ムームードメイン</a>&quot; を利用した。</p>
<p>ドメイン取得後、さくらインターネットの会員メニューへログインし、&quot;<a class="reference external" href="https://help.sakura.ad.jp/app/answers/detail/a_id/2344">ドメインメニュー</a>&quot; からドメインの登録などDNSサーバの利用登録を行う。</p>
<p>※契約した最安プランでも５ゾーンまで無料で利用出来る。</p>
<p>※ドメインに紐付けるサーバのIPアドレスは、VPSのIPアドレスを設定</p>
<p>ドメインの登録が完了したら&quot;ゾーン情報&quot;から、NSレコードを確認する。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">例</span><span class="p">)</span>
<span class="n">ns1</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">jp</span><span class="o">.</span>
<span class="n">ns2</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">ne</span><span class="o">.</span><span class="n">jp</span><span class="o">.</span>
</pre></div>
</div>
<p><a class="reference external" href="http://muumuu-domain.com/">ムームードメイン</a> のコントロールパネルにログインし、[ネームサーバ設定変更] を選択 <a class="reference external" href="http://vps.sakura.ad.jp/">さくらVPS</a> へ登録したドメインを選択し、&quot;GMOペパボ以外 のネームサーバを使用する&quot; という項目に上記ネームサーバの設定を行う。</p>
<p>※必要に応じてさくらVPSコントロールパネルを開き、VPSの設定にて、逆引きホスト名を紐付けたドメイン名に変更する。</p>
<p>以後、24時間程度様子を見ながら、正引き/逆引きが可能となっている事を確認する。</p>
</div>
<div class="section" id="zoho">
<h2><a class="toc-backref" href="#id21">Zohoを利用した独自ドメイン・メール環境の構築</a><a class="headerlink" href="#zoho" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Zoho (<a class="reference external" href="http://www.zoho.jp/">http://www.zoho.jp/</a>) を利用し、独自ドメインのメール環境を整理する。</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, pochio.<br/>
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5 で生成しました。<br/>
    </p>
  </div>
</footer>
  </body>
</html>